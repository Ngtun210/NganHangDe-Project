<div class="exam-editor">
  <div class="header-actions">
    <button class="back-btn" (click)="cancelEdit()">
      <i class="fas fa-arrow-left"></i> Quay lại
    </button>
    <h1>Chỉnh sửa đề thi</h1>
  </div>
  
  <div class="loading-indicator" *ngIf="loading">
    <div class="spinner"></div>
    <p>Đang tải...</p>
  </div>
  
  <div class="error-message" *ngIf="error">
    <p>{{ error }}</p>
    <button (click)="cancelEdit()">Quay lại</button>
  </div>
  
  <div class="success-message" *ngIf="success">
    <p>{{ success }}</p>
    <button (click)="cancelEdit()">Quay lại danh sách</button>
  </div>
  
  <div class="form-container" *ngIf="exam && !loading && !error">
    <div class="exam-info">
      <p class="info-label">Bộ câu hỏi:</p>
      <p class="info-value">{{ exam.questionSetTitle }}</p>
      <p class="info-label">Số câu hỏi:</p>
      <p class="info-value">{{ exam.questionCount }}</p>
    </div>
    
    <form (submit)="updateExam()">
      <div class="form-group">
        <label for="title">Tên đề thi <span class="required">*</span></label>
        <input 
          type="text" 
          id="title" 
          name="title" 
          [(ngModel)]="formData.title" 
          required
          maxlength="100"
        >
      </div>
      
      <div class="form-group">
        <label for="description">Mô tả</label>
        <textarea 
          id="description" 
          name="description" 
          [(ngModel)]="formData.description"
          rows="3"
          maxlength="500"
        ></textarea>
      </div>
      
      <div class="form-group">
        <label for="duration">Thời gian làm bài (phút) <span class="required">*</span></label>
        <input 
          type="number" 
          id="duration" 
          name="duration" 
          [(ngModel)]="formData.duration" 
          required
          min="5"
          max="300"
        >
      </div>
      
      <div class="form-group">
        <label>Quyền truy cập <span class="required">*</span></label>
        <div class="radio-group">
          <div class="radio-option">
            <input 
              type="radio" 
              id="access-public" 
              name="accessType" 
              value="public" 
              [(ngModel)]="formData.accessType"
            >
            <label for="access-public">Công khai - Tất cả học sinh đều có thể làm bài</label>
          </div>
          
          <div class="radio-option">
            <input 
              type="radio" 
              id="access-class" 
              name="accessType" 
              value="class" 
              [(ngModel)]="formData.accessType"
            >
            <label for="access-class">Lớp học - Chỉ học sinh trong lớp được chọn</label>
          </div>
          
          <div class="radio-option">
            <input 
              type="radio" 
              id="access-selected" 
              name="accessType" 
              value="selected" 
              [(ngModel)]="formData.accessType"
            >
            <label for="access-selected">Học sinh được chọn - Chỉ một số học sinh cụ thể</label>
          </div>
        </div>
      </div>
      
      <div class="form-group" *ngIf="formData.accessType === 'class'">
        <label for="classId">Chọn lớp <span class="required">*</span></label>
        <select 
          id="classId" 
          name="classId" 
          [(ngModel)]="formData.classId" 
          required
        >
          <option value="">-- Chọn lớp học --</option>
          <option *ngFor="let cls of classes" [value]="cls.id">{{ cls.name }}</option>
        </select>
        
        <div class="empty-state" *ngIf="classes.length === 0">
          <p>Bạn chưa có lớp học nào</p>
          <a routerLink="/dashboard/classes">Tạo lớp học mới</a>
        </div>
      </div>
      
      <div class="form-group" *ngIf="formData.accessType === 'selected'">
        <label>Chọn học sinh <span class="required">*</span></label>
        
        <div class="empty-state" *ngIf="selectedStudents.length === 0">
          <p>Chưa có học sinh nào được chọn</p>
        </div>
        
        <div class="student-list" *ngIf="selectedStudents.length > 0">
          <div class="student-item" *ngFor="let student of selectedStudents">
            <input 
              type="checkbox" 
              [id]="'student-' + student.id" 
              [name]="'student-' + student.id"
              [checked]="formData.selectedStudentIds?.includes(student.id)"
              (change)="toggleStudent(student.id, $event)"
            >
            <label [for]="'student-' + student.id">{{ student.name }} ({{ student.email }})</label>
          </div>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="button" class="cancel-btn" (click)="cancelEdit()">Hủy</button>
        <button type="submit" class="save-btn" [disabled]="loading">
          <i class="fas fa-save"></i> Lưu thay đổi
        </button>
      </div>
    </form>
  </div>
</div> 