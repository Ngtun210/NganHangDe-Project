<div class="dashboard-greeting">
  <h1>Xin ch√†o, {{ currentUser?.name }}</h1>
  <p>Ch√†o m·ª´ng tr·ªü l·∫°i v·ªõi Ng√¢n H√†ng ƒê·ªÅ Thi</p>
</div>

<div class="dashboard-stats">
  <div class="stat-card">
    <div class="stat-icon">üìä</div>
    <div class="stat-content">
      <h3>{{ recentExams.length }}</h3>
      <p>ƒê·ªÅ thi ƒë√£ ho√†n th√†nh</p>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">üìù</div>
    <div class="stat-content">
      <h3>{{ upcomingExams.length }}</h3>
      <p>ƒê·ªÅ thi s·∫Øp t·ªõi</p>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">üèÜ</div>
    <div class="stat-content">
      <h3>{{ calculateAvgScore | number:'1.1-1' }}</h3>
      <p>ƒêi·ªÉm trung b√¨nh</p>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon">üìö</div>
    <div class="stat-content">
      <h3>{{ subjectStats.length }}</h3>
      <p>M√¥n h·ªçc</p>
    </div>
  </div>
</div>

<div class="dashboard-sections">
  <!-- New Classes Section -->
  <div class="dashboard-section">
    <div class="section-header">
      <h2>L·ªõp h·ªçc c·ªßa t√¥i</h2>
      <a class="view-all" routerLink="/dashboard/student-classes">Xem t·∫•t c·∫£</a>
    </div>
    <div class="class-list" *ngIf="studentClasses && studentClasses.length > 0; else noClasses">
      <div class="class-preview-card" *ngFor="let class of studentClasses.slice(0, 3)">
        <div class="class-preview-header">
          <h3>{{ class.name }}</h3>
          <span class="class-badge">L·ªõp {{ class.grade }}</span>
        </div>
        <div class="class-preview-actions">
          <button class="btn btn-outline" routerLink="/dashboard/student-classes">Xem chi ti·∫øt</button>
        </div>
      </div>
    </div>
    <ng-template #noClasses>
      <div class="empty-state">
        <div class="empty-icon">üë®‚Äçüè´</div>
        <p>B·∫°n ch∆∞a tham gia l·ªõp h·ªçc n√†o</p>
        <button class="btn btn-primary" routerLink="/dashboard/student-classes">Tham gia l·ªõp h·ªçc</button>
      </div>
    </ng-template>
  </div>

  <div class="dashboard-section">
    <div class="section-header">
      <h2>ƒê·ªÅ thi s·∫Øp t·ªõi</h2>
      <a class="view-all" routerLink="/dashboard/student-exams">Xem t·∫•t c·∫£</a>
    </div>
    <div class="exam-list" *ngIf="upcomingExams.length > 0; else noUpcomingExams">
      <div class="exam-card" *ngFor="let exam of upcomingExams">
        <div class="exam-header">
          <h3>{{ exam.title }}</h3>
          <span class="exam-subject">{{ exam.subject }}</span>
        </div>
        <div class="exam-details">
          <div class="exam-detail">
            <span class="detail-label">S·ªë c√¢u h·ªèi:</span>
            <span class="detail-value">{{ exam.questions }}</span>
          </div>
          <div class="exam-detail">
            <span class="detail-label">Th·ªùi gian:</span>
            <span class="detail-value">{{ exam.duration }} ph√∫t</span>
          </div>
          <div class="exam-detail" *ngIf="exam.dueDate">
            <span class="detail-label">H·∫°n n·ªôp:</span>
            <span class="detail-value">{{ exam.dueDate | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>
        <div class="exam-actions">
          <button class="btn btn-primary" [disabled]="exam.status === 'coming'" routerLink="/dashboard/student-exams">
            <span *ngIf="exam.status === 'available'">L√†m b√†i</span>
            <span *ngIf="exam.status === 'coming'">S·∫Øp m·ªü</span>
          </button>
        </div>
      </div>
    </div>
    <ng-template #noUpcomingExams>
      <div class="empty-state">
        <div class="empty-icon">üìù</div>
        <p>Kh√¥ng c√≥ ƒë·ªÅ thi s·∫Øp t·ªõi</p>
        <button class="btn btn-primary" routerLink="/dashboard/student-exams">Xem t·∫•t c·∫£ ƒë·ªÅ thi</button>
      </div>
    </ng-template>
  </div>
  
  <div class="dashboard-section">
    <div class="section-header">
      <h2>B√†i thi g·∫ßn ƒë√¢y</h2>
      <a class="view-all" routerLink="/dashboard/student-exams">Xem t·∫•t c·∫£</a>
    </div>
    <div class="exam-list" *ngIf="recentExams.length > 0; else noRecentExams">
      <div class="exam-card" *ngFor="let exam of recentExams">
        <div class="exam-header">
          <h3>{{ exam.title }}</h3>
          <span class="exam-subject">{{ exam.subject }}</span>
        </div>
        <div class="exam-score" *ngIf="exam.score !== undefined">
          <div class="score-circle">
            <span>{{ exam.score }}</span>
          </div>
        </div>
        <div class="exam-details">
          <div class="exam-detail">
            <span class="detail-label">S·ªë c√¢u h·ªèi:</span>
            <span class="detail-value">{{ exam.questions }}</span>
          </div>
          <div class="exam-detail">
            <span class="detail-label">Th·ªùi gian:</span>
            <span class="detail-value">{{ exam.duration }} ph√∫t</span>
          </div>
        </div>
        <div class="exam-actions">
          <button class="btn btn-secondary" routerLink="/dashboard/student-exams">Xem chi ti·∫øt</button>
        </div>
      </div>
    </div>
    <ng-template #noRecentExams>
      <div class="empty-state">
        <div class="empty-icon">üìù</div>
        <p>Ch∆∞a c√≥ b√†i thi n√†o ho√†n th√†nh</p>
        <button class="btn btn-primary" routerLink="/dashboard/student-exams">Xem t·∫•t c·∫£ ƒë·ªÅ thi</button>
      </div>
    </ng-template>
  </div>
  
  <div class="dashboard-section">
    <div class="section-header">
      <h2>Th·ªëng k√™ theo m√¥n h·ªçc</h2>
    </div>
    <div class="subject-stats" *ngIf="subjectStats.length > 0; else noSubjectStats">
      <div class="subject-card" *ngFor="let stat of subjectStats">
        <h3>{{ stat.subject }}</h3>
        <div class="subject-details">
          <div class="subject-detail">
            <span class="detail-label">ƒêi·ªÉm trung b√¨nh:</span>
            <span class="detail-value">{{ stat.avgScore | number:'1.1-1' }}</span>
          </div>
          <div class="subject-detail">
            <span class="detail-label">ƒê·ªÅ thi ƒë√£ l√†m:</span>
            <span class="detail-value">{{ stat.completedExams }}</span>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress" [style.width.%]="(stat.avgScore / 10) * 100"></div>
        </div>
      </div>
    </div>
    <ng-template #noSubjectStats>
      <div class="empty-state">
        <div class="empty-icon">üìä</div>
        <p>Ch∆∞a c√≥ d·ªØ li·ªáu th·ªëng k√™</p>
      </div>
    </ng-template>
  </div>

  <div class="dashboard-section" id="history" #historySection>
    <div class="section-header">
      <h2>L·ªãch s·ª≠ b√†i thi</h2>
    </div>
    
    <div class="exam-history" *ngIf="!historyLoading && !historyError && examHistory.length > 0">
      <table class="history-table">
        <thead>
          <tr>
            <th>T√™n b√†i thi</th>
            <th>L·ªõp</th>
            <th>Th·ªùi gian l√†m</th>
            <th>ƒêi·ªÉm s·ªë</th>
            <th>Tr·∫°ng th√°i</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let history of examHistory.slice(0, 5)">
            <td>{{ history.examTitle }}</td>
            <td>{{ history.className }}</td>
            <td>{{ history.startTime | date:'dd/MM/yyyy HH:mm' }}</td>
            <td>
              <span [ngClass]="getScoreClass(history.score)">
                {{ history.score ? (history.score | number:'1.1-1') : 'N/A' }}
              </span>
            </td>
            <td>
              <span [ngClass]="getStatusClass(history.status)">
                {{ history.status === 'completed' ? 'ƒê√£ ho√†n th√†nh' : 
                    history.status === 'in_progress' ? 'ƒêang l√†m' : 'ƒê√£ h·ªßy' }}
              </span>
            </td>
            <td>
              <button 
                class="btn btn-sm btn-primary" 
                *ngIf="history.completed"
                (click)="viewExamResult(history.attemptId)">
                Xem k·∫øt qu·∫£
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div *ngIf="historyLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p>ƒêang t·∫£i l·ªãch s·ª≠ b√†i thi...</p>
    </div>
    
    <div *ngIf="historyError" class="error-message">
      <p>{{ historyError }}</p>
      <button class="btn btn-primary" (click)="loadExamHistory()">Th·ª≠ l·∫°i</button>
    </div>
    
    <div *ngIf="!historyLoading && !historyError && examHistory.length === 0" class="empty-state">
      <div class="empty-icon">üìä</div>
      <p>Ch∆∞a c√≥ l·ªãch s·ª≠ b√†i thi</p>
      <button class="btn btn-primary" routerLink="/dashboard/student-exams">Xem ƒë·ªÅ thi</button>
    </div>
  </div>
</div>
